import{c as j,r as t,j as e,X as R,L as _,S as $,A as E,a as p}from"./index-C26tifPK.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=j("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=j("CircleUserRound",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=j("ImagePlus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=j("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=j("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),M=t.memo(({comment:o,formatDate:x,index:m,isPinned:n=!1})=>e.jsxs("div",{className:`px-4 pt-4 pb-2 rounded-xl border transition-all group hover:shadow-lg hover:-translate-y-0.5 ${n?"bg-gradient-to-r from-indigo-500/10 to-purple-500/10 border-indigo-500/30 hover:bg-gradient-to-r hover:from-indigo-500/15 hover:to-purple-500/15":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[n&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-indigo-400",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wide",children:"Pinned Comment"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[o.avatar_url?e.jsx("img",{src:o.avatar_url,alt:`${o.name}'s profile`,className:`w-10 h-10 rounded-full object-cover border-2 flex-shrink-0  ${n?"border-indigo-500/50":"border-indigo-500/30"}`,loading:"lazy"}):e.jsx("div",{className:`p-2 rounded-full text-indigo-400 group-hover:bg-indigo-500/30 transition-colors ${n?"bg-indigo-500/30":"bg-indigo-500/20"}`,children:e.jsx(I,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:`font-medium truncate ${n?"text-indigo-200":"text-white"}`,children:o.name}),n&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-indigo-500/20 text-indigo-300 rounded-full",children:"Admin"})]}),e.jsx("span",{className:"text-xs text-gray-400 whitespace-nowrap",children:x(o.created_at)})]}),e.jsx("p",{className:"text-gray-300 text-sm break-words leading-relaxed relative bottom-2",children:o.comment})]})]})]})),D=t.memo(({onSubmit:o,isSubmitting:x,error:m})=>{const[n,y]=t.useState(""),[u,g]=t.useState(""),[b,h]=t.useState(null),[w,f]=t.useState(null),i=t.useRef(null),c=t.useRef(null),v=t.useCallback(r=>{const a=r.target.files[0];if(a){if(a.size>5*1024*1024){alert("File size must be less than 5MB. Please choose a smaller image."),r.target&&(r.target.value="");return}if(!a.type.startsWith("image/")){alert("Please select a valid image file."),r.target&&(r.target.value="");return}f(a);const s=new FileReader;s.onloadend=()=>h(s.result),s.readAsDataURL(a)}},[]),C=t.useCallback(r=>{y(r.target.value),i.current&&(i.current.style.height="auto",i.current.style.height=`${i.current.scrollHeight}px`)},[]),N=t.useCallback(r=>{r.preventDefault(),!(!n.trim()||!u.trim())&&(o({newComment:n,userName:u,imageFile:w}),y(""),g(""),h(null),f(null),c.current&&(c.current.value=""),i.current&&(i.current.style.height="auto"))},[n,u,w,o]);return e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2","data-aos":"fade-up","data-aos-duration":"1000",children:[e.jsxs("label",{className:"block text-sm font-medium text-white",children:["Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:u,onChange:r=>g(r.target.value),maxLength:15,placeholder:"Enter your name",className:"w-full p-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-400 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 transition-all",required:!0})]}),e.jsxs("div",{className:"space-y-2","data-aos":"fade-up","data-aos-duration":"1200",children:[e.jsxs("label",{className:"block text-sm font-medium text-white",children:["Message ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("textarea",{ref:i,value:n,maxLength:200,onChange:C,placeholder:"Write your message here...",className:"w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-400 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 transition-all resize-none min-h-[120px]",required:!0})]}),e.jsxs("div",{className:"space-y-2","data-aos":"fade-up","data-aos-duration":"1400",children:[e.jsxs("label",{className:"block text-sm font-medium text-white",children:["Profile Photo ",e.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),e.jsx("div",{className:"flex items-center gap-4 p-4 bg-white/5 border border-white/10 rounded-xl",children:b?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:b,alt:"Profile preview",className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-500/50"}),e.jsxs("button",{type:"button",onClick:()=>{h(null),f(null),c.current&&(c.current.value="")},className:"flex items-center gap-2 px-4 py-2 rounded-full bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-all group",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:"Remove Photo"})]})]}):e.jsxs("div",{className:"w-full",children:[e.jsx("input",{type:"file",ref:c,onChange:v,accept:"image/*",className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>{var r;return(r=c.current)==null?void 0:r.click()},className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-indigo-500/20 text-indigo-400 hover:bg-indigo-500/30 transition-all border border-dashed border-indigo-500/50 hover:border-indigo-500 group",children:[e.jsx(L,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Choose Profile Photo"})]}),e.jsx("p",{className:"text-center text-gray-400 text-sm mt-2",children:"Max file size: 5MB"})]})})]}),e.jsxs("button",{type:"submit",disabled:x,"data-aos":"fade-up","data-aos-duration":"1000",className:"relative w-full h-12 bg-gradient-to-r from-[#6366f1] to-[#a855f7] rounded-xl font-medium text-white overflow-hidden group transition-all duration-300 hover:scale-[1.02] hover:shadow-lg active:scale-[0.98] disabled:opacity-50 disabled:hover:scale-100 disabled:cursor-not-allowed",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 translate-y-12 group-hover:translate-y-0 transition-transform duration-300"}),e.jsx("div",{className:"relative flex items-center justify-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Posting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Post Comment"})]})})]})]})}),z=()=>{const[o,x]=t.useState([]),[m,n]=t.useState(null),[y,u]=t.useState(!1),[g,b]=t.useState(""),[h,w]=t.useState(""),[f,i]=t.useState(!0);t.useEffect(()=>{E.init({once:!0,duration:1e3})},[]);const c=t.useCallback(async()=>{w("");try{const[a,s]=await Promise.all([p.from("portfolio_comments").select("*").eq("is_pinned",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle(),p.from("portfolio_comments").select("*").eq("is_pinned",!1).order("created_at",{ascending:!1})]);if(a.error)throw a.error;if(s.error)throw s.error;n(a.data),x(s.data||[])}catch(a){console.error("Error fetching comments:",a),w("Failed to load comments. Please check your connection or RLS policies.")}},[]);t.useEffect(()=>{i(!0),c().finally(()=>i(!1));const a=p.channel("portfolio_comments").on("postgres_changes",{event:"*",schema:"public",table:"portfolio_comments"},s=>{console.log("Change received!",s),c()}).subscribe();return()=>{a.unsubscribe()}},[c]);const v=t.useCallback(async a=>{if(!a)return null;const s=a.name.split(".").pop(),l=`profile-images/${`${Date.now()}_${Math.random().toString(36).substring(2)}.${s}`}`,{error:d}=await p.storage.from("profile-images").upload(l,a);if(d)throw d;const{data:k}=p.storage.from("profile-images").getPublicUrl(l);return k.publicUrl},[]),C=t.useCallback(async({newComment:a,userName:s,imageFile:S})=>{b(""),u(!0);try{const l=await v(S),{error:d}=await p.from("portfolio_comments").insert([{comment:a,name:s,avatar_url:l,is_pinned:!1,created_at:new Date().toISOString()}]);if(d)throw d}catch(l){b("Failed to post comment. Please try again."),console.error("Error adding comment: ",l)}finally{u(!1)}},[v]),N=t.useCallback(a=>{if(!a)return"";const s=new Date(a),l=Math.floor((new Date-s)/(1e3*60)),d=Math.floor(l/60),k=Math.floor(d/24);return l<1?"Just now":l<60?`${l}m ago`:d<24?`${d}h ago`:k<7?`${k}d ago`:new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(s)},[]),r=o.length+(m?1:0);return e.jsxs("div",{className:"w-full bg-gradient-to-b from-white/10 to-white/5 rounded-2xl  backdrop-blur-xl shadow-xl","data-aos":"fade-up","data-aos-duration":"1000",children:[e.jsx("div",{className:"p-6 border-b border-white/10","data-aos":"fade-down","data-aos-duration":"800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-indigo-500/20",children:e.jsx(A,{className:"w-6 h-6 text-indigo-400"})}),e.jsxs("h3",{className:"text-xl font-semibold text-white",children:["Comments ",e.jsxs("span",{className:"text-indigo-400",children:["(",r,")"]})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[g&&e.jsxs("div",{className:"flex items-center gap-2 p-4 text-red-400 bg-red-500/10 border border-red-500/20 rounded-xl","data-aos":"fade-in",children:[e.jsx(P,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:g})]}),h&&!f&&e.jsxs("div",{className:"flex items-center gap-2 p-4 text-yellow-400 bg-yellow-500/10 border border-yellow-500/20 rounded-xl","data-aos":"fade-in",children:[e.jsx(P,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:h})]}),e.jsx("div",{children:e.jsx(D,{onSubmit:C,isSubmitting:y,error:g})}),e.jsx("div",{className:"space-y-4 h-[328px] overflow-y-auto overflow-x-hidden custom-scrollbar pt-1 pr-1 ","data-aos":"fade-up","data-aos-delay":"200",children:f?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(_,{className:"w-8 h-8 text-indigo-400 animate-spin"})}):e.jsxs(e.Fragment,{children:[m&&e.jsx("div",{"data-aos":"fade-down","data-aos-duration":"800",children:e.jsx(M,{comment:m,formatDate:N,index:0,isPinned:!0})}),o.length===0&&!m&&!h?e.jsxs("div",{className:"text-center py-8","data-aos":"fade-in",children:[e.jsx(I,{className:"w-12 h-12 text-indigo-400 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-gray-400",children:"No comments yet. Start the conversation!"})]}):o.map((a,s)=>e.jsx(M,{comment:a,formatDate:N,index:s+(m?1:0),isPinned:!1},a.id))]})})]}),e.jsx("style",{children:`
                .custom-scrollbar::-webkit-scrollbar {
                    width: 6px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 6px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: rgba(99, 102, 241, 0.5);
                    border-radius: 6px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: rgba(99, 102, 241, 0.7);
                }
            `})]})};export{z as default};
